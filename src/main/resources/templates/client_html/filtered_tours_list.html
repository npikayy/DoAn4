<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOUR BẠN MUỐN TÌM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Montserrat', sans-serif; }
        .tour-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .tour-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .tour-image-container {
            height: 180px;
            overflow: hidden;
        }
        .tour-image {
            transition: transform 0.5s ease;
        }
        .tour-card:hover .tour-image {
            transform: scale(1.05);
        }
        .discount-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #f72585, #b5179e);
        }
        .date-badge {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50">
<header th:replace="client_html/fragment/headerANDfooter :: header"></header>

<div class="container mx-auto px-4 py-8">
    <div class="text-sm text-gray-600 mb-6">
        <a href="/Client/Home" class="hover:text-blue-800 hover:underline">Trang chủ</a>
        <span class="mx-2">/</span>
        <span>Tour bạn muốn tìm</span>
        <span th:if="${region != null}" class="mx-2">/</span>
        <a th:if="${region != null}" th:href="'/Client/ToursList/'+ ${region}"
           th:text="${region == 'NORTH'} ? 'Miền Bắc' :
                   (${region == 'CENTRAL'} ? 'Miền Trung' :
                   (${region == 'SOUTHEAST'} ? 'Miền Đông Nam Bộ' : 'Miền Tây Nam Bộ'))"
           class="hover:text-blue-800 hover:underline"></a>
        <span th:if="${location != null}" class="mx-2">/</span>
        <a th:if="${location != null}" th:href="'/Client/ToursList/'+ ${region} + '/' + ${location}"
           th:text="${location}" class="hover:text-blue-800 hover:underline"></a>
    </div>

    <!-- Header Section -->
    <div class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl font-bold text-red-600 mb-4">TOUR BẠN ĐANG MUỐN TÌM</h1>
        <p class="text-lg text-gray-600 max-w-3xl mx-auto">
            Khám phá ngay những tour du lịch phù hợp nhất với sở thích và nhu cầu của bạn. Chúng tôi mang đến đa dạng lựa chọn từ tour trong nước đến quốc tế với nhiều mức giá hấp dẫn.
        </p>
    </div>

    <!-- Tour Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" th:if="${not tours.isEmpty()}">
        <!-- Tour Card -->
        <div th:each="tour : ${tours}" class="tour-card bg-white rounded-lg overflow-hidden">
            <a th:href="@{'/Client/TourDetail/' + ${tour.tour_id}}" class="block">
                <!-- Image with Discount Badge -->
                <div class="tour-image-container relative">
                    <img th:if="${tourThumbnails.get(tour.tour_id) != null and !tourThumbnails.get(tour.tour_id).isEmpty()}"
                         th:src="${tourThumbnails.get(tour.tour_id)}"
                         alt="Tour image"
                         class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                    <img th:unless="${tourThumbnails.get(tour.tour_id) != null and !tourThumbnails.get(tour.tour_id).isEmpty()}"
                         src="/img/default-tour.jpg"
                         alt="Default tour image"
                         class="w-full h-full object-cover">

                    <!-- Discount Badge -->
                    <div th:if="${activePromotions.containsKey(tour.tour_id)}"
                         class="absolute top-4 right-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold shadow-md">
                        <span th:text="'- ' + ${activePromotions.get(tour.tour_id).phanTramGiamGia} + ' %'"></span>
                    </div>

                    <!-- Duration -->
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                        <span class="text-sm bg-black/50 px-3 py-1 rounded-full text-white"
                              th:text="${tour.tour_duration} + ' ngày ' + (${tour.tour_duration} - 1) + ' đêm'"></span>
                    </div>
                </div>

                <!-- Tour Content -->
                <div class="p-5">
                    <!-- Tour Title -->
                    <h3 class="text-xl font-bold text-gray-800 mb-2 line-clamp-2" th:text="${tour.tour_name}"></h3>
                    <!-- Rating -->
                    <div class="flex items-center mb-3">
                        <div class="flex text-yellow-400 mr-2">
                            <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                <i th:class="${i <= tour.tour_rating} ? 'fas fa-star text-yellow-400' :
                                ((${(i > tour.tour_rating) and (i-1 < tour.tour_rating)}) ? 'fas fa-star-half-alt text-yellow-400' :
                                'far fa-star text-yellow-400')"></i>
                            </th:block>
                        </div>
                        <span class="text-sm text-gray-600 font-medium"
                              th:text="${#numbers.formatDecimal(tour.tour_rating, 1, 1)}"></span>
                    </div>
                    <!-- Location & Date -->
                    <div class="flex flex-col gap-3 text-sm text-gray-600 mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                            <span th:text="${tour.tour_region == 'NORTH'} ? 'Miền Bắc' :
                                (${tour.tour_region == 'CENTRAL'} ? 'Miền Trung' :
                                (${tour.tour_region == 'SOUTHEAST'} ? 'Miền Đông Nam Bộ' : 'Miền Tây Nam Bộ'))"></span>
                        </div>

                        <!-- Departure Dates -->
                        <div>
                            <div class="flex items-center mb-1">
                                <i class="fas fa-calendar-alt text-red-500 mr-2"></i>
                                <span class="font-medium">Ngày khởi hành:</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <!-- Hiển thị tối đa 3 ngày -->
                                <span th:each="date,iter : ${tourStartDates.get(tour.tour_id)}"
                                      th:if="${iter.index < 3}"
                                      class="date-badge bg-red-500 font-bold text-white text-xs px-2 py-1 rounded-full">
                                    <span th:text="${#temporals.format(date.start_date, 'dd/MM')}"></span>
                                </span>
                                <!-- Hiển thị số lượng ngày còn lại nếu có -->
                                <span th:if="${tourStartDates.get(tour.tour_id).size() > 3}"
                                      class="date-badge text-xs px-2 py-1 rounded-full">
                                    +<span th:text="${tourStartDates.get(tour.tour_id).size() - 3}"></span> ngày khác
                                </span>
                                <!-- Trường hợp không có ngày khởi hành -->
                                <span th:if="${tourStartDates.get(tour.tour_id).isEmpty()}"
                                      class="date-badge text-xs px-2 py-1 rounded-full">
                                    Liên hệ
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                                                <div>
                                                    <div th:if="${activePromotions.containsKey(tour.tour_id)}"
                                                         class="text-sm text-gray-400 line-through mb-1">
                                                        <span th:text="${#numbers.formatInteger(tour.tour_adult_price, 3, 'POINT') + '₫'}"></span>
                                                    </div>
                                                    <div class="text-blue-600 font-bold text-xl">
                                                        <span th:with="promo=${activePromotions.get(tour.tour_id)}"
                                                              th:text="${#numbers.formatInteger(
                                                            promo != null ?
                                                            tour.tour_adult_price * (100 - promo.phanTramGiamGia) / 100 :
                                                            tour.tour_adult_price, 3, 'POINT') + '₫'}"></span>
                                                    </div>                        <div class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                            Đặt ngay
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Empty State -->
    <div th:if="${tours.isEmpty()}" class="text-center py-12 bg-white rounded-lg shadow-sm">
        <div class="inline-block p-6">
            <div class="text-red-500 mb-4">
                <i class="fas fa-tag text-5xl"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-700 mb-2">Hiện không có tour theo nhu cầu của bạn</h3>
            <p class="text-gray-500 mb-4">Vui lòng quay lại sau</p>
            <a href="/Client/ToursList" class="inline-block bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium">
                Xem tất cả tour
            </a>
        </div>
    </div>
</div>

<footer th:replace="client_html/fragment/headerANDfooter :: footer"></footer>
</body>
</html>